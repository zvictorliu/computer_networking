---
title: TCP协议
type: docs
weight: 2
---

# TCP协议

## 报文格式

<img src="https://cdn.jsdelivr.net/gh/zvictorliu/typoraPics@main/img/image-20230613222900611.png" alt="image-20230613222900611" style="zoom:57%;" />

各个字段的含义：

- 序号
  - TCP传输的每个字节都按顺序编号，序号字段存入本报文段数据的第一个自己序号

- 确认号
- 数据偏移（首部长度）
- 保留
- 紧急位URG
- 确认位ACK
- 推送位PSH
- 复位位RST
- 同步位SYN
- 终止位FIN
- 窗口
- 紧急指针
- 选项
- 填充

## 连接管理

### 建立

三个要求：

- 每一方都要知道对方的存在
- 双方需要协商某些参数
- 对运输实体资源分配

每条连接以两端的套接字确定，需要三次握手：

- 客户机向服务器发送请求报文段
  - 这个报文段比较特殊，发出去后进入 `SYN-SENT`状态

- 服务器收到，同意，发回确认
  - 进入`SYN-RCVD`状态

- 客户机收到后，再向服务器发出确认
  - 进入`ESTABLISHED`状态

### 释放

四次握手



## 可靠传输

首部的确认号是期望对方收到的下一个报文段的序号，检查这个

累积确认方式，并不是按顺序的

超时和冗余ACK时会进行重传

- 收到比期望的序号大的，发送一个冗余ACK指明，当发送方收到3个冗余ACK后就会重传

## 流量控制

基于滑动窗口

## 拥塞控制

