---
title: 6.1 DHCP
type: docs
weight: 1
---

# 动态主机配置协议DHCP

主机访问web服务器需要配置IP地址、子网掩码、默认网关、DNS服务器等信息

但是手工配置比较麻烦，于是设置了DHCP服务器，自动获取配置信息

其过程是：

- 客户启动DHCP：广播DHCP发现报文，此时由于还未配置IP地址等，数据报中的源IP地址用`0.0.0.0`，目的地址用`255.255.255.255`。这些是默认写好的，报文中还有自己的MAC地址和事务ID
- 所有设备收到数据报：对于DHCP客户端没有相应端口67，丢弃；对于DHCP服务器接收并进行响应
- 报文中有客户的MAC地址，服务器查找数据库中的配置信息。有则发送DHCP提供报文，没有则发送默认配置信息。目的IP仍然为广播地址
- 所有设备收到数据报：DHCP服务器有相应端口68因而丢弃，DHCP客户根据事务ID知道是自己请求的，接收
- 再次广播请求服务器同意（可能有多个DHCP服务器），此时还是`0.0.0.0`
- 服务器确认后，才进行配置

同时还有ARP检查IP地址是否已经被占用

<img src="https://cdn.jsdelivr.net/gh/zvictorliu/typoraPics@main/img/image-20230625202038745.png" alt="image-20230625202038745"  />

如果有路由器，路由器是不转发广播报文的

办法是给路由器配置DHCP服务器的IP地址，使之成为中继代理，将广播报文只转发给DHCP服务器